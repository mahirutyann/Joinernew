document.getElementById('joinForm').addEventListener('submit', async function(event) {
    event.preventDefault();
    
    const token = document.getElementById('token').value;
    const inviteLink = document.getElementById('inviteLink').value;
    
    // 招待リンクからコードを抽出（例: https://discord.gg/invitecode → invitecode）
    const inviteCode = inviteLink.split('/').pop().split('?')[0];  // クエリパラメータを無視
    
    if (!token || !inviteCode) {
        document.getElementById('result').innerText = 'トークンと招待リンクを正しく入力してください。';
        return;
    }
    
    try {
        const response = await fetch(`https://discord.com/api/v10/invites/${inviteCode}`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,  // ユーザートークンを使用
                'Content-Type': 'application/json'
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            document.getElementById('result').innerText = 'サーバーへの参加に成功しました！';
            console.log(data);  // デバッグ用
        } else {
            const errorData = await response.json();
            document.getElementById('result').innerText = `エラー: ${errorData.message || '不明なエラー'}`;
        }
    } catch (error) {
        document.getElementById('result').innerText = `エラーが発生しました: ${error.message}`;
    }
});